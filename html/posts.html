<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Posts</title>
</head>
<body>
   <div id="app">
       <h3>
            <a :href="'/dev/group-page?groupId='+ post.group_id">{{post.group_name}}</a>
       </h3>
       <h4>{{post.title}}</h4>
       <p>{{post.text}}</p>
        <br>
        <input v-model="newComment" placeholder="Type your comment here">
        <button v-on:click="addComment(post.annc_id, post.group_id)">Comment</button>
       <h4>All Comments</h4>
       <p>Sort By</p>
       <select>
           <option value="new">New</option>
           <option value="likes">Likes</option>
        </select>
        <div v-for="(comment, index) in comments">
            <b><p>{{comment.char_name}}</p></b>
            <p>{{comment.text}}</p>
            <span>{{comment.likes}} Likes</span>
            <button v-on:click="addLike(comment.likes, comment.comment_id)">Like</button>
            <button v-on:click="reply[index]=true">Reply</button>
            <input v-if="reply[index]" v-model="reply">
        </div>
   </div> 
</body>
</html>
<script type="module">
    // import Banner from './components/Banner.vue';
    new Vue({
        el: "#app",
        data() {
          return {
            postId: location.href.split('?')[1].split('&')[0].split('=')[1],
            post: '',
            comments: [],
            newComment: '',
            likes: '',
            reply: [] 
          }
        },
        mounted: function() {
          this.getPost();
          this.getComments();
        },
        methods: {
            getPost() {
             axios.get(`/dev/post/${this.postId}`)
                .then(response => (this.post = response.data[0], console.log(response)),
                (error) => {
                    console.log(error);
                }); 
            },
            getComments() {
                axios.get(`/dev/comments/${this.postId}`)
                    .then(response => (this.comments = response.data, console.log(response)),
                    (error) => {
                        console.log(error);
                    });
            },
            addComment(anncId, groupId){
                console.log(anncId, groupId)
                // axios.post(`/dev/comments`, {text: this.newComment, userId: 3, groupId: 1, anncId: 1, parentId: 0, likes: 0})
                // .then(response => (console.log(response)),
                // (error) => {
                //     console.log(error);
                // });
                // this.newComment = '';
                // this.getComments();
            },
            addLike(likes, id){
                console.log(likes)
                axios.post(`/dev/likes`, {likes: likes + 1, id: id})
                .then(response => (console.log(response)),
                (error) => {
                    console.log(error);
                });
                this.getComments();
            }
        }
    })
</script>